{% extends "admin/change_form.html" %}
{% load i18n %}
{% load static %}
{% block content %}
<form action="{{ request.get_full_path }}" method="post">
{% csrf_token %}
<div>
    <h2>
        {% blocktrans with version.content as content_name %}
           Add '{{ content_name }}' to collection
        {% endblocktrans %}
    </h2>
    {% if form.non_field_errors %}
        <span>{{ form.non_field_errors }}</span>
    {% endif %}
    <div class="form-row">
        <div class="related-widget-wrapper widget-wrapper-links-2">
            {{ form.version.as_hidden }}
            {{ form.version.errors }}
            {{ form.collection.label_tag }}
            {{ form.collection.errors }}
            {{ form.collection }}
        </div>
    </div>
    <!-- List of collection objects -->
    <div class="results">
     <table>
        <thead>
            <tr>
                <th>{% trans "Content Type" %}</th>
                <th>{% trans "Identifier" %}</th>
                <th>{% trans "Author" %}</th>
                <th>{% trans "Edit Date" %}</th>
                <th>{% trans "Version #" %}</th>
                <th>{% trans "Status" %}</th>
            </tr>
        </thead>
        <tbody>
        {% for mrl in moderation_request_list %}
            <tr class="row1 djangocms_moderation_collections_1">
                <td>{{ mrl.version.content_type|title }}</td>
                <td>{{ mrl.version.content }}</td>
                <td>{{ mrl.version.created_by }}</td>
                <td>{{ mrl.version.created }}</td>
                <td>{{ mrl.version.number }}</td>
                <td>{{ mrl.version.get_state_display }} </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
    <div class="submit-row">
        <input type="submit" value="{% trans 'Submit' %}" class="default" name="_save">
    </div>
</div>
</form>
{% endblock %}

{% block extrahead %}
{{ block.super }}
<script type="text/javascript">
    (function($) {
        $(function() {
            var collection_sel = $('#id_collection');
            collection_sel.data('prev', collection_sel.val());
            collection_sel.on('change', function() {
                var jqThis = $(this);
                var newUrl;
                if (location.href.indexOf('collection_id') === -1) {
                    newUrl = location.href + '&collection_id=' + jqThis.val();
                } else {
                    newUrl = location.href.replace(
                        "collection_id="+jqThis.data("prev"),
                        "collection_id="+jqThis.val()
                    );
                }
                location.href = newUrl;
            });
        });
    })(django.jQuery);
</script>
{% endblock %}
